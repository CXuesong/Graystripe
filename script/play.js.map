{"version":3,"sources":["script/play.ts"],"names":[],"mappings":"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","file":"play.js","sourcesContent":["/// <reference path=\"../../typings/index.d.ts\"/>\r\nimport * as ObjectModel from \"./objectModel\";\r\nimport * as Utility from \"./utility\";\r\nimport * as Ptag from \"./ptag\";\r\n\r\nclass StageHistoryEntry {\r\n    public constructor(public readonly description: string, public readonly selectedOption: string) { }\r\n}\r\n\r\n/**\r\n * An immutable view model.\r\n */\r\nclass StageOptionViewModel {\r\n    public readonly target: string;\r\n    public readonly text: string;\r\n\r\n    public constructor(public readonly model: ObjectModel.StageOption,\r\n        public readonly onClick: (sender: StageOptionViewModel) => void) {\r\n        this.target = model.target;\r\n        this.text = model.text || Utility.escapeHtml(this.target);\r\n    }\r\n\r\n    public notifyClick() {\r\n        if (this.onClick) this.onClick(this);\r\n    }\r\n}\r\n\r\nclass CurrentStageViewModel {\r\n    public readonly stageName = ko.observable(\"[stage]\");\r\n    public readonly prompt = ko.observable(\"[prompt]\");\r\n    public readonly options = ko.observableArray<StageOptionViewModel>();\r\n\r\n    public constructor(public readonly stageContext: Ptag.StageContext,\r\n        public readonly onOptionClick: (option: StageOptionViewModel) => void) {\r\n        this.options.extend({ rateLimit: 100 });\r\n    }\r\n\r\n    public refresh() {\r\n        this.stageName(this.stageContext.currentStage.toString());\r\n        this.prompt(this.stageContext.prompt);\r\n        this.options.removeAll();\r\n        this.stageContext.options.forEach(opt => {\r\n            this.options.push(new StageOptionViewModel(opt, sender => {\r\n                this.onOptionClick(sender);\r\n            }));\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * play.html main VM.\r\n */\r\nclass PlayerViewModel {\r\n    public readonly currentStageVM: CurrentStageViewModel;\r\n    private readonly _engine = new Ptag.GameEngine();\r\n\r\n    public constructor() {\r\n        this.currentStageVM = new CurrentStageViewModel(this._engine.context, opt => { this.gotoStageAsync(opt.target); });\r\n    }\r\n\r\n    // public get engine() { return this._engine; }\r\n    public openGameAsync() {\r\n        return this._engine.openGameAsync(new URI(window.location.href).hash(\"\").search(\"\").filename(\"data/demo/game.json\").toString())\r\n            .done(() => { this.currentStageVM.refresh(); }).fail(err => { console.error(err); });\r\n    }\r\n\r\n    public gotoStageAsync(targetStageName: string) {\r\n        return this._engine.gotoStageAsync(new Ptag.StageName(targetStageName))\r\n            .done(() => { this.currentStageVM.refresh(); }).fail(err => { console.error(err); });\r\n    }\r\n}\r\n\r\nlet vm = new PlayerViewModel();\r\nvm.openGameAsync();\r\nconsole.log(vm);\r\n\r\nko.applyBindings(vm);\r\n"]}